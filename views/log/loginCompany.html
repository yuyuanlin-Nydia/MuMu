<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>企業會員登入</title>
    <link rel="icon" href="../../public/image/logoImg-icon.svg" type="image/x-icon">
</head>
<script src="../js/jquery.js"></script>
<link rel="stylesheet" href="../css/mutual.css">
<link rel="stylesheet" href="../css/login.css">
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Allura&display=swap&family=Noto+Serif+TC:wght@200&display=swap&family=Fraunces&display=swap&family=Homemade+Apple&display=swap');
    /* @import url(./css/login.css); */
    /* @import url('./reset.css'); */

    .mynavbar {
        background-color: #FFF;
    }
    span{
        visibility: hidden;
    }
</style>

</head>

<body>

    <%-include ('../nav.ejs') %>
        <main>
            <div id="main_box">
                <!-- <img id="logo" src="./images/fake.png" alt=""> -->
                <div class="main_content">
                    <ul class="tab-group">
                        <li class="tab active"><a href="#login">企業登入</a></li>
                        <li class="tab "><a href="#signup">企業註冊</a></li>
                    </ul>

                    <div class="tab-content">
                        <!-- 只包含登入&註冊內容 -->
                        <div id="login">
                            <form id="loginForm">

                                <ul  class="contentUl">
                                    <!-- 登入 -->

                                    <li>
                                        <br><input type="text" placeholder="帳號" name="companyAccountL" id="companyAccountL">
                                    </li>
                                    <li>
                                        <br><input type="password" placeholder="密碼" name="companyPasswordL" id="companyPasswordL">
                                    </li>
                                    <br>
                                    <li class="btm_text"> <input type="checkbox"> 記住我</li>



                                </ul><!-- 登入end -->
                                <div class="btndiv"> <button type="submit" value="Login" id="loginSub_c"> 登入</button>
                                </div>
                                <br><a class="btm_text" href="#">忘記密碼?</a>
                            </form>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                        </div>


                        <div id="signup">

                            <form id="signupForm">
                                <!-- <h1>Join us!</h1> -->
                                <ul  class="contentUl">
                                    <!-- 註冊 -->
                                    <li>
                                        <br><input type="text" placeholder="*統一編號" name="companyTaxNo" required id="companyTaxNo">
                                    </li>
                                    <li>
                                        <br><input type="text" placeholder="*公司名稱" name="companyName" required id="companyName">
                                    </li>
                                    <li>
                                        <br><input type="text" placeholder="*Email" name="companyEmail" required id="email">
                                        <span id="if1"><i class='fa fa-exclamation-circle' aria-hidden='true'style="margin: -20px;color:var(--color2)"></i>
                                            <b >格式有誤</b></span>
                                    </li>

                                    <li>
                                        <br><input type="text" placeholder="*帳號" name="companyAccount"  id="accountC" required>
                                            <span id="if2"> <i class='fa fa-exclamation-circle' aria-hidden='true' style="margin: -20px;color:var(--color2)"></i>
                                                <b >帳號重複</b></span>
                                    </li>
                                    <li>
                                        <br><input type="password" placeholder="*密碼&nbsp(至少8位英文+數字)"
                                            name="companyPassword" required id="newpw">
                                            <span id="if3"> <i class='fa fa-exclamation-circle' aria-hidden='true'style="margin: -20px;color:var(--color2)"></i>
                                                <b>至少8位英數</b></span>
                                    </li>
                                    <li>
                                        <br><input type="password" placeholder="*確認密碼" name="userPassword"
                                            maxlength="15" id="newpwCfm">
                                            <span id="if4"><i class='fa fa-exclamation-circle' aria-hidden='true'style="margin: -20px;color:var(--color2)"></i>
                                                <b >密碼不一致</b></span>
                                    </li>
                                    <br>

                                    <li>* 為必填欄位，請填妥欄位資訊。</li>
                                    <li class="btm_text"><input type="checkbox" required>我同意<a href="#">會員使用條款</a> </li>
                                </ul><!-- 註冊end -->

                                <!-- <input type="button" value="Get Started"> -->
                                <div class="btndiv"> <button type="button" value="signup" id="signupSub_c">
                                        加入會員</button>
                                </div>
                            </form>

                        </div> <!-- signup end -->

                    </div><!-- tab-content end -->


                </div>
            </div>

        </main>
        <%- include ('../footer.ejs') %>
            <script>
                 window.addEventListener('keydown', function (e) {
                    if (e.keyCode == 49) {
                        document.getElementById('companyAccountL').value = 'new5520'
                        document.getElementById('companyPasswordL').value = 'new5520'
                    }else if(e.keyCode == 50){
                        document.getElementById('companyTaxNo').value = '52789452'
                        document.getElementById('companyName').value = '角頭音樂'
                        document.getElementById('email').value = 'de584@d'
                        document.getElementById('accountC').value = 'fhjkur178283'
                        document.getElementById('newpw').value = 'angle237'
                        document.getElementById('newpwCfm').value = 'vaaa520'
                    }else if(e.keyCode == 51){
                        document.getElementById('companyName').value = '角頭音樂'
                        document.getElementById('email').value = 'mumufortest01@gmail.com'
                        document.getElementById('accountC').value = 'angle2837'
                        document.getElementById('newpw').value = 'angle2837'
                        document.getElementById('newpwCfm').value = 'angle2837'
                    }else if(e.keyCode == 52){
                        document.getElementById('companyAccountL').value = 'angle2837'
                        document.getElementById('companyPasswordL').value = 'angle2837'
                    }
                    
                }, false);
                $('.tab a').on('click', function (e) {

                    e.preventDefault();

                    $(this).parent().addClass('active');
                    $(this).parent().siblings().removeClass('active');

                    target = $(this).attr('href');

                    $('.tab-content > div').not(target).hide();

                    $(target).fadeIn(600);

                });
                // 註冊
                $('#signupSub_c').on('click', function () {
                    // 序列化表單內容到字串
                    //console.log($('#loginForm').serializeArray());

                    var data = $('#signupForm').serializeArray()
                    // console.log(data);
                    JSONData = serializeToJSON(data)

                    //ajax請求
                    $.ajax({
                        url: "/log/companySignup",
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        data: JSONData,
                        success: function (res) {
                            var res = JSON.parse(res)
                            if (res.errno === 1) {
                                swal("註冊成功，請到信箱收取註冊確認信!", "", "success")
                                .then(
                                    (value)=>location.href = '/log/companyLogin'
                                );
                                
                            } else if (res.errno === 0) {
                                swal("註冊失敗!", "", "error");
                            }
                        },
                        error: function () {
                            alert("系統錯誤!")
                        }
                    })
                    $.ajax({
                        url: "/log/email",
                        type: "post",
                        data: {
                            userName: $('#companyName').val(),
                            email: $('#email').val(),
                            code:Math.floor(Math.random()*900+100)
                        }
                    })
                })

                // 登入
                $('#loginSub_c').on('click', function () {
                    var data = $('#loginForm').serializeArray()
                    JSONData = serializeToJSON(data)

                    $.ajax({
                        url: "/log/companyLogin",
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        data: JSONData,
                        success: function (res) {
                            var res = JSON.parse(res)
                            if (res.errno === 1) {
                                // alert("登入成功!")
                                location.href = '/'
                            } else if (res.errno === 0) {
                                swal("帳號或密碼錯誤，請重新登入!", "", "error");
                            }
                        },
                        error: function () {
                            alert("系統錯誤!")
                        }
                    })
                })
                // 帳號檢查是否重複
                $('#accountC').blur(function(){
                // $('#accountC').css("background-color","#D6D6FF")
                var dataA = $('#accountC').serializeArray()
                    JSONData = serializeToJSON(dataA)

                $.ajax({
                        url: '/log/checkC',
                        type: 'POST',
                        contentType: "application/json; charset=utf-8",
                        data: JSONData,
                        success: function (res) {
                            var res = JSON.parse(res)
                            if (res.errno === undefined) {
                                $("#if2 b:first-of-type").css('visibility','visible');
                                $("#if2 i").css('visibility','visible');
                                } else{ 
                                 $("#if2 b:first-of-type").css('visibility','hidden')
                                 $("#if2 i").css('visibility','hidden');
                            
                            }
                        },
                        error: function () {
                            alert("系統錯誤!")
                        }
                    });
            })
               
                // 轉JSON
                function serializeToJSON(data) {
                    var values = {};
                    for (index in data) {
                        values[data[index].name] = data[index].value;
                    }
                    return JSON.stringify(values)
                }
                // mail格式確認
                $("#email").blur(function () {
                    var mail = $("#email").val();
                    var regex = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
                    if (!regex.test(mail)) {
                        $("#if1").css('visibility', 'visible');
                    } else {
                        $("#if1").css('visibility', 'hidden')
                    }
                })

                //密碼格式確認
                $("#newpw").blur(function () {

                    var pw = $("#newpw").val();
                    var regex = /[a-zA-Z\d]{8,}/;

                    if (!regex.test(pw)) {
                        $("#if3").css('visibility', 'visible');
                    } else {
                        $("#if3").css('visibility', 'hidden')
                    };

                })

                // 檢查兩次密碼是否一致
                $('#newpwCfm').blur(function () {

                    var newps = $('#newpw').val();
                    var newpsCfm = $('#newpwCfm').val();
                    if (newps != newpsCfm) {
                        $("#if4").css('visibility', 'visible');
                    } else {
                        $("#if4").css('visibility', 'hidden')
                    }
                })
            </script>

</body>

</html>